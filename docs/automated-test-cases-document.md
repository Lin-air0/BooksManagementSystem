# 自动化测试用例文档

## 图书借阅信息管理系统

### 版本信息
- 文档版本：v1.0.0
- 创建日期：2025年8月24日
- 作者：自动化测试工程师

## 一、测试概述

本文档包含图书借阅信息管理系统的8个核心自动化测试用例，覆盖3类核心功能：
1. 综合查询测试（3个用例）
2. 借阅流程测试（3个用例）
3. 可视化测试（2个用例）

## 二、测试环境
- 前端地址：http://localhost:4000
- 后端API地址：http://localhost:3001/api
- 测试框架：Playwright
- 测试文件：test/book-system-test.js

## 三、测试用例详细设计

### 1. 综合查询测试

#### 用例1：按分类+书名查询
- **测试目标**：验证系统能够正确响应分类+书名组合查询
- **测试步骤**：
  1. 发送GET请求到/api/books/search
  2. 参数：category=文学, title=三体, page=1, pageSize=10
  3. 接收并解析响应
- **预期结果**：
  1. 响应状态码为200
  2. 响应数据格式正确（包含total、list、page、pageSize字段）
  3. 返回的图书列表不为空
  4. 所有返回图书的分类包含'文学'，书名包含'三体'

#### 用例2：按读者类型+作者查询
- **测试目标**：验证系统能够正确响应读者类型+作者组合查询
- **测试步骤**：
  1. 发送GET请求到/api/books/search
  2. 参数：readerType=student, author=鲁迅, page=1, pageSize=10
  3. 接收并解析响应
- **预期结果**：
  1. 响应状态码为200
  2. 响应数据格式正确
  3. 返回的图书列表不为空
  4. 所有返回图书的作者包含'鲁迅'

#### 用例3：按库存+出版社查询
- **测试目标**：验证系统能够正确响应库存+出版社组合查询
- **测试步骤**：
  1. 发送GET请求到/api/books/search
  2. 参数：stock=0（表示有库存）, publisher=人民文学出版社, page=1, pageSize=10
  3. 接收并解析响应
- **预期结果**：
  1. 响应状态码为200
  2. 响应数据格式正确
  3. 所有返回图书的库存大于0，出版社包含'人民文学出版社'

### 2. 借阅流程测试

#### 用例4：借阅存在库存的图书
- **测试目标**：验证借阅流程正常工作，库存正确扣减
- **测试步骤**：
  1. 发送GET请求到/api/books/{bookId}，获取当前库存
  2. 发送POST请求到/api/borrow，提交借阅信息（book_id、reader_id、borrow_days）
  3. 发送GET请求到/api/books/{bookId}，获取更新后的库存
- **预期结果**：
  1. 借阅请求响应状态码为200
  2. 借阅响应数据中的status为'borrowed'
  3. 图书的可借数量（available）减少1
  4. 系统返回'借阅成功'消息

#### 用例5：尝试借阅库存为0的图书
- **测试目标**：验证系统能够正确拒绝库存为0的图书借阅请求
- **测试步骤**：
  1. 准备一本库存为0的图书ID
  2. 发送POST请求到/api/borrow，提交借阅信息
  3. 接收并解析响应
- **预期结果**：
  1. 响应状态码为400
  2. 响应消息包含'库存不足'
  3. 借阅操作失败

#### 用例6：归还已借阅的图书
- **测试目标**：验证归还流程正常工作，库存正确增加
- **测试步骤**：
  1. 先尝试借阅一本图书
  2. 发送PUT请求到/api/return/{borrowId}，执行归还操作
  3. 发送GET请求到/api/books/{bookId}，获取更新后的库存
- **预期结果**：
  1. 归还请求响应状态码为200
  2. 归还响应消息为'归还成功'
  3. 图书的可借数量（available）增加1

### 3. 可视化测试

#### 用例7：首页ECharts图表加载
- **测试目标**：验证首页的ECharts图表能够正确加载
- **测试步骤**：
  1. 访问系统首页（http://localhost:4001）
  2. 等待页面加载完成
  3. 检查ECharts图表容器是否存在
- **预期结果**：
  1. 页面加载成功
  2. 图表容器DOM元素可见
  3. 没有图表加载错误

#### 用例8：首页统计数据展示
- **测试目标**：验证首页的统计数据区域能够正确展示
- **测试步骤**：
  1. 访问系统首页（http://localhost:4001）
  2. 等待页面加载完成
  3. 检查统计数据区域是否存在
  4. 检查是否包含统计数字
- **预期结果**：
  1. 页面加载成功
  2. 统计数据区域可见
  3. 包含多个统计数字

## 四、测试执行说明

1. 确保前端和后端服务器正常运行
2. 执行命令：`npx playwright test`
3. 查看测试报告：`npx playwright show-report`

## 五、测试结果分析

- 测试通过：所有断言条件满足
- 测试失败：记录失败截图和错误日志，分析可能原因
  - 综合查询失败：检查API参数传递和后端查询逻辑
  - 借阅流程失败：检查库存扣减逻辑和事务处理
  - 可视化失败：检查ECharts初始化和数据加载

## 六、问题反馈流程

1. 严重级别定义
   - 阻塞级：核心功能无法使用（如借阅功能失败）
   - 重要级：非核心功能异常（如某个查询条件无效）
   - 轻微级：UI显示问题（如图表样式错误）

2. 反馈渠道
   - 阻塞级问题：立即通知开发人员并创建高优先级Issue
   - 重要级问题：创建Issue并指派给相关开发人员
   - 轻微级问题：记录到项目问题跟踪表，后续版本修复